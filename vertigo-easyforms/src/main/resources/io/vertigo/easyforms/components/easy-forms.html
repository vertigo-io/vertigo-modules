<th:block th:fragment="easy-forms-edit(object, field, rowIndex, template, isI18nLabel, elem_attrs)" 
	vu:alias="easy-forms" vu:selector="${viewMode=='edit'}"
	th:assert="${object} != null and ${field} != null and ${template} != null">
	
	<vu:include-data object="${object}" field="${field}" modifiable="true"/>
	
	<vui-easy-forms th:v-model="${model.util.vueDataKey(object, field, rowIndex)}" class="full-width" >
		<template v-slot:default="slotProps">
			<div class="row q-col-gutter-md">
				<th:block th:each="templateField : ${template.fields}"
				          th:with="fieldType = ${model.efoUiUtil.getFieldTypeByName(templateField.fieldTypeName)}, fieldParameters = ${model.efoUiUtil.getParametersForField(templateField)}, fieldId = ${object}+'_'+${field}+'_'+${rowIndex}+'$'+${templateField.code}">
				    <div th:attr="__${elem_attrs}__" class="col-12" >
						<div th::class="|{'fr-input-group--error' : hasFieldsError('${object}', 'form_${templateField.code}', ${rowIndex})}|"
						      th:switch="${fieldType.uiComponentName}">
						    
						    <vu:content></vu:content>
						    
							<div th:case="'EfUicInternalMap'">
								<vu:label-edit object="${object}" field="|form_${field}|" th:label="${isI18nLabel != null && isI18nLabel ? '#{__${templateField.label}__}' : templateField.label}" required="false">
									<vu:slot name="after_label_slot">
										<!--/* We don't use required attribute on vu:label => Hack so that subsequent inputs don't have the red * */-->
										<span th:if="${templateField.isMandatory}" class="v-block__required"></span>
									</vu:slot>
									<vui-ef-map th:v-model="|slotProps.formData['${templateField.code}']|"
								            	th:value-label="#{EfUicMap$value}" th:label-Label="#{EfUicMap$label}" ></vui-ef-map>
								</vu:label-edit>
							</div>
							<div th:case="'EfUicRadio'">
								<vu:label-edit object="${object}" field="|form_${field}|" th:label="${isI18nLabel != null && isI18nLabel ? '#{__${templateField.label}__}' : templateField.label}" required="${templateField.isMandatory}">
									<q-option-group
								    	th:v-model="|slotProps.formData['${templateField.code}']|"
								    	th::options="${model.efoUiUtil.getDynamicListForField(templateField)}"
										th::inline="${(fieldParameters['radioLayout'] != null && fieldParameters['radioLayout'] == 'horizontal') ? true : false }"
								    	color="primary"
								    ></q-option-group>
								</vu:label-edit>
							</div>
							<div th:case="'EfUicCheckbox'">
								<vu:label-edit object="${object}" field="|form_${field}|" th:label="${isI18nLabel != null && isI18nLabel ? '#{__${templateField.label}__}' : templateField.label}" required="${templateField.isMandatory}"
											   th:@vue:before-mount="|function() { if (!slotProps.formData['${templateField.code}']) { slotProps.formData['${templateField.code}'] = []}}|">
									<q-option-group
								    	th:v-model="|slotProps.formData['${templateField.code}']|"
								    	th::options="${model.efoUiUtil.getDynamicListForField(templateField)}"
								    	type="checkbox"
										th::inline="${(fieldParameters['radioLayout'] != null && fieldParameters['radioLayout'] == 'horizontal') ? true : false }"
								    	color="primary"
								    ></q-option-group>
								</vu:label-edit>
							</div>
							<div th:case="'EfUicSelect'"
								 th:attr="objectKey=${model.vContext['componentStates'].addComponentState(fieldId).addPrimitive('searchValue','')}">
								<q-select
									th:v-model="|slotProps.formData['${templateField.code}']|"
									fill-input map-options emit-value
							        th::use-input="${fieldParameters['selectSearchable'] == true}" 
							        th::hide-selected="${fieldParameters['selectSearchable'] == true}"
							        th::options="${model.efoUiUtil.getDynamicListForField(templateField, fieldParameters['selectSearchable'] != null && fieldParameters['selectSearchable'] ? 'componentStates.'+fieldId+'.searchValue' : null)}"
						            th:@filter="${fieldParameters['selectSearchable'] != null && fieldParameters['selectSearchable'] ? '(val, update, abort) => update(() => this.componentStates.'+fieldId+'.searchValue = val, ref => ref.setOptionIndex(0))' :null}"
									th:label="${isI18nLabel != null && isI18nLabel ? '#{__${templateField.label}__}' : templateField.label}"
									th:classappend="|${templateField.isMandatory?'v-field__required':''}|"
						            th:aria-required="${templateField.isMandatory}"
						            th::error="|hasFieldsError('${object}', 'form_${templateField.code}', ${rowIndex})|" 
									th::error-message="|getErrorMessage('${object}', 'form_${templateField.code}', ${rowIndex})|"
									orientation="vertical"
									stack-label>
								</q-select>
							</div>
							<div th:case="*">
								<q-input label-slot
										th:v-autofocus="|hasFieldsError('${object}', 'form_${templateField.code}', ${rowIndex})|"
										th:v-model="|slotProps.formData['${templateField.code}']|"
										th::aria-describedby="|hasFieldsError('${object}', 'form_${templateField.code}', ${rowIndex}) ? 'text-input-${templateField.code}-${templateField.order}-desc-error' : null|"
										th::aria-invalid="|hasFieldsError('${object}', 'form_${templateField.code}', ${rowIndex})|" 
										th:id="|text-input-${templateField.code}-${templateField.order}|"
										th::error="|hasFieldsError('${object}', 'form_${templateField.code}', ${rowIndex})|" 
										th::error-message="|getErrorMessage('${object}', 'form_${templateField.code}', ${rowIndex})|"
										th:type="${fieldType.uiComponentName == 'textfield' ? 'text' : (fieldType.uiComponentName == 'EfUicDate' ? 'date' : 'text')}"
										th:autocomplete="${fieldParameters['textFieldAutocomplete']}"
										th:maxlength="${model.efoUiUtil.smartTypeMaxLength(templateField.fieldTypeName)}"
										orientation="vertical"
										stack-label
										th:classappend="${templateField.isMandatory?'v-field__required':''}"
										th:aria-required="${templateField.isMandatory}" >
										<template v-slot:label>
										  <div class="row items-center all-pointer-events non-selectable" style="display: inline-block;">
										    <div vu:text="${templateField.label}" />
										    <q-tooltip th:if="${templateField.tooltip}" class="bg-grey-8" anchor="top left" self="bottom left" :delay="300" :offset="[0, 8]"><div vu:text="${templateField.tooltip}"/></q-tooltip>
										  </div>
										</template>
								</q-input>
							</div>
						</div>
					</div>
				</th:block>
		</template>
	</vui-easy-forms>
	
	<input type="hidden" th::name="${model.util.contextKey(object, field, rowIndex)}" th:v-bind:value="|JSON.stringify(${model.util.vueDataKey(object, field, rowIndex)})|" />
</th:block>

<th:block th:fragment="easy-forms-read(object, field, rowIndex, template, isI18nLabel, elem_attrs)" 
	vu:alias="easy-forms" vu:selector="${viewMode=='read'}"
	th:assert="${object} != null and ${field} != null and ${template} != null">
	
	<vu:include-data object="${object}" field="${field}"/>
	
	<div class="row q-col-gutter-md">
		<div th:attr="__${elem_attrs}__" class="col-12" th:v-for="|(value, name) in ${model.efoUiUtil.getEasyFormRead(template, object, field, rowIndex)}|">
	         <q-field :label="name" orientation="vertical" stack-label readonly borderless >
	             {{ value }}
	         </q-field>
	    </div>
    </div>
</th:block>
